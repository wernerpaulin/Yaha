<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Yaha :: Demo page</title>
	<link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
	<link rel="manifest" href="/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

    <style type="text/css">



body
{
   margin: 0;
   padding: 0;
   background-color: #FFFFFF;
   color: #000000;
}

<style type="text/css">
#txtLogOutput
{
   border: 1px #C0C0C0 solid;
   background-color: #FFFFFF;
   color :#000000;
   font-family: Arial;
   font-size: 13px;
   text-align: left;
}
</style>
</head>
  
<body>
<script src="jquery-2.1.3.min.js"></script>
<script src="yaha-juice.js"></script>

<script>
//Plug-in to detect enter key
$.fn.enterKey = function (fnc) {
    return this.each(function () {
        $(this).keypress(function (ev) {
            var keycode = (ev.keyCode ? ev.keyCode : ev.which);
            if (keycode == '13') {
                fnc.call(this, ev);
            }
        })
    })
}



//walk through DOM with jQuery as soon as document is fully loaded
jQuery(document).ready(function()
{
	var ReadCyclicIDs = new Array()
	var WriteClickTriggerIDs = {}
	var WriteBlurTriggerIDs = {}
	var TagGroups = {}
	
	var ATTR_PROPERTY_INDEX = 0
	var ATTR_VALUE_INDEX = 1
	var propertyName = ""
	var propertyValueList = new Array()
	
	 //find all tags with a yaha attribute - BEGIN
	 $("[yaha]").each(function() 
	 {
		attrString = $(this).attr('yaha');				//property:value1,value2;property:value
		//get all property and values of attribute
		yahaPropertyList = attrString.split(';')
	 	
	 	//analyze properties - BEGIN
	 	for (p in yahaPropertyList) 	//go through each definition: property:value1,value2
	 	{
	 		yahaPropertyEntry = yahaPropertyList[p].trim().split(':')								//remove white space
	 		propertyName = yahaPropertyEntry[ATTR_PROPERTY_INDEX].trim()	//remove white space

			//one property might has more then one value  (e.g. io_mode:read_cyclic,write_click)
			yahaPropertyEntry[ATTR_VALUE_INDEX] = yahaPropertyEntry[ATTR_VALUE_INDEX].trim()		//remove white space
	 		propertyValueList = yahaPropertyEntry[ATTR_VALUE_INDEX].split(',')
			for (pv in propertyValueList) { propertyValueList[pv] = propertyValueList[pv].trim() }	//remove white space for each value
			
			switch(propertyName)
			{
				//io_mode: defines whether the tag will be written or read
				case "io_mode":
					for (pv in propertyValueList)
					{
						switch(propertyValueList[pv])
						{
							case "read_cyclic":
								ReadCyclicIDs.push($(this).prop('id'))
							break;

							case "write_click":
								WriteClickTriggerIDs[$(this).prop('id')] = ""		//add ID to write list, however group to write will be assigned later on
							break;
							case "write_blur":
								WriteBlurTriggerIDs[$(this).prop('id')] = ""		//add ID to write list, however group to write will be assigned later on
							break;
						}
					}	
				break;

				//tag_group_wr_click: defines which tag group should be written in case a click event on this ID has been fired 
				case "tag_group_wr_click":
					WriteClickTriggerIDs[$(this).prop('id')] = propertyValueList[0]		//add name of tag group which should be written
				break;

				//tag_group_wr_blur: defines which tag group should be written in case a blur event on this ID has been fired 
				case "tag_group_wr_blur":
					WriteBlurTriggerIDs[$(this).prop('id')] = propertyValueList[0]		//add name of tag group which should be written
				break;
				
				//tag_group: one tag can be member of several groups. All members of a group will be treated the same way (e.g. for writing)
				case "tag_group":
					for (pv in propertyValueList)							
					{
						if (propertyValueList[pv] in TagGroups)
						{
							//group with ID array exists already -> add new ID
							TagGroups[propertyValueList[pv]].push($(this).prop('id'))	//group name: [ID1, ID2,...]
						}
						else
						{
							//groups has not yet been created -> create group, initialize it as array and add new ID
							TagGroups[propertyValueList[pv]] = []
							TagGroups[propertyValueList[pv]].push($(this).prop('id'))
						}
					}
				break;

			}			
		}
	 	//analyze properties - END
		
		
	 });	
	//find all tags with a yaha attribute - END

	
	//Initialize all tags which has been configured for cyclic read
	yjDefineCyclicReadTagList(ReadCyclicIDs)
	
	//Hook all IDs which should be written on click event
	for (id in WriteClickTriggerIDs)
	{
		jQuery("#" + id).click(
		function()
		{
			//WriteClickTriggerIDs[id] contains tag group to write
			if (WriteClickTriggerIDs[$(this).prop('id')] == "")							//no group specified -> send id of tag
			{
				yjWriteTagList(new Array($(this).prop('id')));
			}
			else
			{
				yjWriteTagList(TagGroups[WriteClickTriggerIDs[$(this).prop('id')]])		//group specified -> send members of group (if ID of trigger tag not in group then it will not be sent)
			}
		});			
	}
	

	//Hook all IDs which should be written on blur event
	for (id in WriteBlurTriggerIDs)
	{
		jQuery("#" + id).blur(
		function()
		{
			//WriteBlurTriggerIDs[id] contains tag group to write
			if (WriteBlurTriggerIDs[$(this).prop('id')] == "")							//no group specified -> send id of tag
			{
				yjWriteTagList(new Array($(this).prop('id')));
			}
			else
			{
				yjWriteTagList(TagGroups[WriteBlurTriggerIDs[$(this).prop('id')]])		//group specified -> send members of group (if ID of trigger tag not in group then it will not be sent)
			}
		});			
	}
	
	
	
	/* generically write value of a certain input element on enter and remove focus to allow refresh again */
	$("input").attr("autocomplete","off");  //disable auto complete as a single enter might not be sufficient to apply a new value if the value has been entered before
	$(document).enterKey(function () 
	{
	    yjWriteTagList(new Array(document.activeElement.id));
	    BlurTimer = setInterval(function(){ blurElement() }, 100);		//delay blur otherwise applying value to element won't work stable
	})

	

	//hook post processing function into update cycle so formating of numbers and units is possible
	yjAddPostUpdateUiFunction(postUpdateUi)

	//start UI refresh
	yjStartCyclicUIrefresh(300)



});

function blurElement()
{
	document.getElementById(document.activeElement.id).blur(); 
	clearInterval(BlurTimer); 
}



function addCommas(nStr)
{
	nStr += '';
	x = nStr.split('.');
	x1 = x[0];
	x2 = x.length > 1 ? '.' + x[1] : '';
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	return x1 + x2;
}


//this function can be used to reformat raw valued from the server
function postUpdateUi(jsonData)
{
	//data from server comes in JSON format => convert to JavaScript object
	dataFromServer = jQuery.parseJSON(jsonData)

	//update only tags which where updated
	for (tag in dataFromServer)
	{
		switch(tag)
		{
			case "uiSystemTickRunTime":
				numFloat = parseFloat(jQuery("#uiSystemTickRunTime").text()) * 1000
				jQuery("#uiSystemTickRunTime").text(numFloat.toFixed(2))
			break;
			
			case "uiCpuLoad":
				numFloat = parseFloat(jQuery("#uiCpuLoad").text()) * 100
				jQuery("#uiCpuLoad").text(numFloat.toFixed(2))			
			break;
				
			case "uiRcpNameList":
				yjHelperFillSelect("uiRcpNameList", "uiRcpNameSelector")
			break;
			
			case "uiIoLight1switchedOn":
				if (jQuery("#uiIoLight1switchedOn").text() == "1") 
				{
					jQuery("#uiIoLight1switchedOn").text("on")
				}
				else
				{
					jQuery("#uiIoLight1switchedOn").text("off")
				}
			break;

			case "uiIoLight2switchedOn":
				if (jQuery("#uiIoLight2switchedOn").text() == "1") 
				{
					jQuery("#uiIoLight2switchedOn").text("on")
				}
				else
				{
					jQuery("#uiIoLight2switchedOn").text("off")
				}
			break;
			
			case "uiIoActTempLivingroom":
				numFloat = parseFloat(jQuery("#uiIoActTempLivingroom").text())
				jQuery("#uiIoActTempLivingroom").text(numFloat.toFixed(1))
			break;
		}
	}
}
</script>

  	<p></p>
  	<p></p>
  	
  	<p>Var 1: <span id="uiVar1" yaha="io_mode:read_cyclic ; tag_group:VAR_GRP_A">tbd...</span></p>
  	<p>Var 2  <input type="text" id="uiVar2" yaha="io_mode:read_cyclic ; tag_group:VAR_GRP_A"></p>
  	<p>Var 3: <span id="uiVar3" yaha="io_mode:read_cyclic ; tag_group:VAR_GRP_A">tbd...</span></p>
  	
  	<p><button type="button" id="cmdWrite" yaha="io_mode:write_click ; tag_group_wr_click:VAR_GRP_A">Write Values</button></p>

  	<p>Count 1<input type="text" id="uiCount1" yaha="io_mode:read_cyclic"></p>

  	<p>Cycle time: <span id="uiSystemTickRunTime" yaha="io_mode:read_cyclic">tbd...</span> ms</p>
  	<p>CPU load: <span id="uiCpuLoad" yaha="io_mode:read_cyclic">tbd...</span> %</p>

  	
  	<p><select id="uiSelectStandard" yaha="io_mode:read_cyclic,write_click">
		<option value="Select1">Select1 text</option>
		<option value="Select2">Select2 text</option>
		<option value="Select3">Select3 text</option>
	</select></p>
  	
  	<p><select  id="uiSelectGroup" yaha="io_mode:read_cyclic,write_click">
		<optgroup label="Select Group 1">
		  <option value="Select1G1">Select1G1 text</option>
		  <option value="Select2G1">Select2G1 text</option>
		</optgroup>
		<optgroup label="Select Group 2">
		  <option value="Select1G2">Select1G2 text</option>
		  <option value="Select2G2">Select2G2 text</option>
		</optgroup>
	</select>
	<span id="uiSelectText" yaha="io_mode:read_cyclic">tbd...</span>
	</p>
  	
  	<br>
	<form action="">
		<input type="radio" name="radiogroup" id="uiRadiogroup1" value="radio1" yaha="io_mode:read_cyclic,write_click ; tag_group_wr_click:RADIO_GRP_A ; tag_group:RADIO_GRP_A">radio1 text<br>
		<input type="radio" name="radiogroup" id="uiRadiogroup2" value="radio2" yaha="io_mode:read_cyclic,write_click ; tag_group_wr_click:RADIO_GRP_A ; tag_group:RADIO_GRP_A">radio2 text
	</form>

	<br>
  	<form action="">
		<input type="checkbox" name="checkboxgroup" id="uiCheckboxgroup1" value="check1" yaha="io_mode:read_cyclic,write_click ; tag_group_wr_click:CHECK_GRP_A ; tag_group:CHECK_GRP_A">check1 text<br>
		<input type="checkbox" name="checkboxgroup" id="uiCheckboxgroup2" value="check2" yaha="io_mode:read_cyclic,write_click ; tag_group_wr_click:CHECK_GRP_A ; tag_group:CHECK_GRP_A">check2 text 
	</form>

	<br>

	<table border="0">
	  <tr>
	    <th>Info / Action</th>
	    <th>Light 1</th>
	    <th>Light 2</th>
	  </tr>
	  <tr>
	    <td>On / Off:</td>
	    <td><button type="button" id="cmdLight1On" yaha="io_mode:write_click ; tag_group_wr_click:LIGHT1_ON">on</button><button type="button" id="cmdLight1Off" yaha="io_mode:write_click ; tag_group_wr_click:LIGHT1_OFF">off</button></td>
	    <td><button type="button" id="cmdLight2On">on</button><button type="button" id="cmdLight2Off">off</button></td>
	  </tr>
	  <tr>
	    <td>On time:</td>
	    <td><span id="uiIoLight1onTime" yaha="io_mode:read_cyclic">tbd...</span></td>
	    <td><span id="uiIoLight2onTime" yaha="io_mode:read_cyclic">tbd...</span></td>
	  </tr>
	  <tr>
	    <td>Energy:</td>
	    <td><span id="uiIoLight1energy" yaha="io_mode:read_cyclic">tbd...</span></td>
	    <td><span id="uiIoLight2energy" yaha="io_mode:read_cyclic">tbd...</span></td>
	  </tr>
	  <tr>
	    <td>Switched:</td>
	    <td><span id="uiIoLight1switchedOn" yaha="io_mode:read_cyclic">tbd...</span></td>
	    <td><span id="uiIoLight2switchedOn" yaha="io_mode:read_cyclic">tbd...</span></td>
	  </tr>
	  <tr>
	    <td>Learning:</td>
	    <td><button type="button" id="cmdLight1teach">learn</button></td>
	    <td><button type="button" id="cmdLight2teach">learn</button></td>
	  </tr>

	</table>
  	<!-- the following line stores the flags used to send button trigger to server -->
	<div style="visibility:hidden"><span id="uiLight1on" yaha="tag_group:LIGHT1_ON">1</span><span id="uiLight1off" yaha="tag_group:LIGHT1_OFF">1</span></div>
	<div style="visibility:hidden"><span id="uiLight2on">1</span><span id="uiLight2off">1</span></div>
	<div style="visibility:hidden"><span id="uiLight1teach">1</span><span id="uiLight2teach">1</span></div>




  	<p>Living room temperature: <span id="uiIoActTempLivingroom" yaha="io_mode:read_cyclic">tbd...</span>°C</p>
  	<p>Living room panel set point: <span id="uiIoSetTempLivingroom" yaha="io_mode:read_cyclic">tbd...</span></p>

	<form action="">
		<input type="radio" name="uiSwitch1" id="uiSwitch1" value="radio1" yaha="io_mode:read_cyclic">Switch 1<br>
	</form>

  	

	<p>Current recipe: <span id="uiCurrentRcpName" yaha="io_mode:read_cyclic">tbd...</span></p>

  	<p>Choose your home configuration: 
  	<select id="uiRcpNameSelector" yaha="io_mode:read_cyclic, write_blur ; tag_group_wr_click:RCP_LOAD">
  		<!-- Options filled dynamically -->
  	</select>
  	
  	<button type="button" id="cmdLoadRcp" yaha="io_mode:write_click ; tag_group_wr_click:RCP_LOAD">Load</button>
  	<button type="button" id="cmdSaveRcp" yaha="io_mode:write_click ; tag_group_wr_click:RCP_SAVE">Save</button></p>
  	<!-- the following line stores the flags used to send button trigger to server -->
	<div style="visibility:hidden"><span id="uiCmdLoadRcp" yaha="tag_group:RCP_LOAD">1</span><span id="uiCmdSaveRcp" yaha="tag_group:RCP_SAVE">1</span></div>
  	
  	<span style="visibility:hidden" id="uiRcpNameList" yaha="io_mode:read_cyclic">tbd...</span>

  	<p>New recipe: <input type="text" id="uiNewRcpName" yaha="tag_group:RCP_CREATE">
  	<button type="button" id="cmdCreateRcp" yaha="io_mode:write_click ; tag_group_wr_click:RCP_CREATE">Create</button></p>
	
  	<!-- the following line stores the flags used to send button trigger to server -->
	<div style="visibility:hidden"><span id="uiCmdCreateRcp" yaha="tag_group:RCP_CREATE">1</span></div>
 
	<p><textarea name="txtLogOutput" id="uiLogEnocean" style="position:relative;left:100px;top:20px;width:640px;height:240px;z-index:1;"
      rows="1"
      cols="1">deaktiviert wegen UDP-Framegröße
    </textarea></p>
    
	<svg width="400" height="180">
	<g>
	  <rect id="demoRect" x="50" y="20" rx="20" ry="20" width="150" height="150" style="fill:red;stroke:black;stroke-width:5;opacity:0.5" />
	  <text x="105" y="95" font-family="Verdana" font-size="12" fill="blue" > Hello </text>
	</g>
	</svg>
  </body>
</html>
